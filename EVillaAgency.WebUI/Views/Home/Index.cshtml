@model IndexHouseFavoriteModel

@{
    ViewData["Title"] = "Index";
    Layout = "~/Views/Shared/_UILayout.cshtml";
}

<script src="~/lib/jquery/dist/jquery.min.js"></script>
<script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
<script src="~/js/site.js" asp-append-version="true"></script>
<script src="~/microsoft/signalr/dist/browser/signalr.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/5.0.9/signalr.min.js"></script>

<div class="main-banner">
    <div class="owl-carousel owl-banner">
        @foreach (var house in Model.TopFavoritedHouses)
        {
            <div class="item item-1">
                <div class="header-text">
                    <span class="category">@house.DictrictName, <em>@house.CityName</em></span>
                    <h2>@house.Title</h2>
                </div>
            </div>
        }
    </div>
</div>

<div class="featured section">
    <div class="container">
        <div class="row">
            <div class="col-lg-4">
                <div class="left-image">
                    <img src="assets/images/featured.jpg" alt="">
                    <a href="property-details.html"><img src="assets/images/featured-icon.png" alt="" style="max-width: 60px; padding: 0px;"></a>
                </div>
            </div>
            <div class="col-lg-5">
                <div class="section-heading">
                    <h6>| Featured</h6>
                    <h2>Best Appartment &amp; Sea view</h2>
                </div>
                <div class="accordion" id="accordionExample">
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="headingOne">
                            <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                                Best useful links ?
                            </button>
                        </h2>
                        <div id="collapseOne" class="accordion-collapse collapse show" aria-labelledby="headingOne" data-bs-parent="#accordionExample">
                            <div class="accordion-body">
                                Get <strong>the best villa</strong> website template in HTML CSS and Bootstrap for your business. TemplateMo provides you the <a href="https://www.google.com/search?q=best+free+css+templates" target="_blank">best free CSS templates</a> in the world. Please tell your friends about it.
                            </div>
                        </div>
                    </div>
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="headingTwo">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                                How does this work ?
                            </button>
                        </h2>
                        <div id="collapseTwo" class="accordion-collapse collapse" aria-labelledby="headingTwo" data-bs-parent="#accordionExample">
                            <div class="accordion-body">
                                Dolor <strong>almesit amet</strong>, consectetur adipiscing elit, sed doesn't eiusmod tempor incididunt ut labore consectetur <code>adipiscing</code> elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.
                            </div>
                        </div>
                    </div>
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="headingThree">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                                Why is Villa Agency the best ?
                            </button>
                        </h2>
                        <div id="collapseThree" class="accordion-collapse collapse" aria-labelledby="headingThree" data-bs-parent="#accordionExample">
                            <div class="accordion-body">
                                Dolor <strong>almesit amet</strong>, consectetur adipiscing elit, sed doesn't eiusmod tempor incididunt ut labore consectetur <code>adipiscing</code> elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-3">
                <div class="info-table">
                    <ul>
                        <li>
                            <img src="assets/images/info-icon-01.png" alt="" style="max-width: 52px;">
                            <h4>250 m2<br><span>Total Flat Space</span></h4>
                        </li>
                        <li>
                            <img src="assets/images/info-icon-02.png" alt="" style="max-width: 52px;">
                            <h4>Contract<br><span>Contract Ready</span></h4>
                        </li>
                        <li>
                            <img src="assets/images/info-icon-03.png" alt="" style="max-width: 52px;">
                            <h4>Payment<br><span>Payment Process</span></h4>
                        </li>
                        <li>
                            <img src="assets/images/info-icon-04.png" alt="" style="max-width: 52px;">
                            <h4>Safety<br><span>24/7 Under Control</span></h4>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="video section">
    <div class="container">
        <div class="row">
            <div class="col-lg-4 offset-lg-4">
                <div class="section-heading text-center">
                    <h6>| Video View</h6>
                    <h2>Get Closer View & Different Feeling</h2>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="video-content">
    <div class="container">
        <div class="row">
            <div class="col-lg-10 offset-lg-1">
                <div class="video-frame">
                    <img src="~/VillaAgency-1.0.0/assets/images/villaHouse.png" alt="">
                    <a href="https://www.youtube.com/watch?v=BwvhJUi2804" target="_blank"><i class="fa fa-play"></i></a>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="fun-facts">
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <div class="wrapper">
                    <div class="row">
                        <script type="text/javascript">

                            $(document).ready(() => {

                                var connection = new signalR.HubConnectionBuilder().withUrl("https://localhost:7037/SignalRHub").build();
                                $("#connstatus").text(connection.state);
                                connection.start().then(() => {
                                    $("#connstatus").text(connection.state);
                                    setInterval(() => {
                                        connection.invoke("SendStatistic");
                                    }, 1000);
                                }).catch((err) => { console.log(err) });


                                connection.on("GetTotalHousesCount", (value) => {
                                    $("#housecount").text(value);
                                });

                                connection.on("GetTotalUsersCount", (value2) => {
                                    $("#usercount").text(value2);
                                });

                                connection.on("GetTotalOwnerCount", (value2) => {
                                    $("#ownercount").text(value2);
                                });
                            });

                        </script>
                        <div class="col-lg-4">
                            <div class="counter">
                                <h2 class="timer count-title count-number" id="housecount"></h2>
                                <p class="count-text ">Toplam<br>Ev Sayımız</p>
                            </div>
                        </div>
                        <div class="col-lg-4">
                            <div class="counter">
                                <h2 class="timer count-title count-number" id="usercount"></h2>
                                <p class="count-text ">Toplam<br>Kullanıcı Sayımız</p>
                            </div>
                        </div>
                        <div class="col-lg-4">
                            <div class="counter">
                                <h2 class="timer count-title count-number" id="ownercount"></h2>
                                <p class="count-text ">Toplam<br>Ev Sahiplerimiz</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="section best-deal">
    <div class="container">
        <div class="row">
            <div class="col-lg-4">
                <div class="section-heading">
                    <h6>| Best Deal</h6>
                    <h2>Find Your Best Deal Right Now!</h2>
                </div>
            </div>
            <div class="col-lg-12">
                <div class="tabs-content">
                    <div class="row">
                        <div class="nav-wrapper">
                            <ul class="nav nav-tabs" role="tablist">
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link active" id="appartment-tab" data-bs-toggle="tab" data-bs-target="#appartment" type="button" role="tab" aria-controls="appartment" aria-selected="true" data-house-type-id="1">Apartment</button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="villa-tab" data-bs-toggle="tab" data-bs-target="#villa" type="button" role="tab" aria-controls="villa" aria-selected="false" data-house-type-id="2">Villa</button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="penthouse-tab" data-bs-toggle="tab" data-bs-target="#penthouse" type="button" role="tab" aria-controls="penthouse" aria-selected="false" data-house-type-id="3">Penthouse</button>
                                </li>
                            </ul>
                        </div>
                        <div class="tab-content" id="myTabContent">
                            <div class="tab-pane fade show active" id="appartment" role="tabpanel" aria-labelledby="appartment-tab">
                                <div class="row" id="appartment-content" data-house-type-id="1">
                                    <!-- AJAX content will be loaded here -->
                                </div>
                            </div>
                            <div class="tab-pane fade" id="villa" role="tabpanel" aria-labelledby="villa-tab">
                                <div class="row" id="villa-content" data-house-type-id="2">
                                    <!-- AJAX content will be loaded here -->
                                </div>
                            </div>
                            <div class="tab-pane fade" id="penthouse" role="tabpanel" aria-labelledby="penthouse-tab">
                                <div class="row" id="penthouse-content" data-house-type-id="3">
                                    <!-- AJAX content will be loaded here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="properties section">
    <div class="container">
        <div class="row">
            <div class="col-lg-4 offset-lg-4">
                <div class="section-heading text-center">
                    <h6>| Properties</h6>
                    <h2>We Provide The Best Property You Like</h2>
                </div>
            </div>
        </div>
        <div class="row">

            @foreach (var house in Model.LastSixHouses)
            {
                <div class="col-lg-4 col-md-6">
                    <div class="item">
                        <a href="/Home/HouseSingle/@house.HouseId"><img src="@house.ImageUrl" alt=""></a>
                        <span class="category">Luxury Villa</span>
                        <h6>@house.Price </h6>
                        <h4><a href="/Home/HouseSingle/@house.HouseId">@house.Title</a></h4>
                        <ul>
                            <li>Banyo: <span>@house.Bedrooms</span></li>
                            <li>Yatak Odası: <span>@house.Bathrooms</span></li>
                            <li>m²: <span>@house.Size</span></li>
                            <li>Havuz: <span>@(house.Pool ? "Havuzlu" : "Havuzu Yok")</span></li>
                            <li>Yıl: <span>@house.YearBuilt</span></li>
                        </ul>
                        <div class="main-button">
                            <a href="/Home/HouseSingle/@house.HouseId">Schedule a visit</a>
                        </div>
                    </div>
                </div>

            }
        </div>
    </div>
</div>

<div class="contact section">
    <div class="container">
        <div class="row">
            <div class="col-lg-4 offset-lg-4">
                <div class="section-heading text-center">
                    <h6>| Contact Us</h6>
                    <h2>Get In Touch With Our Agents</h2>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="contact-content">
    <div class="container">
        <div class="row">
            <div class="col-lg-7">
                <div id="map">
                    <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d12469.776493332698!2d-80.14036379941481!3d25.907788681148624!2m3!1f357.26927939317244!2f20.870722720054623!3f0!3m2!1i1024!2i768!4f35!3m3!1m2!1s0x88d9add4b4ac788f%3A0xe77469d09480fcdb!2sSunny%20Isles%20Beach!5e1!3m2!1sen!2sth!4v1642869952544!5m2!1sen!2sth" width="100%" height="500px" frameborder="0" style="border:0; border-radius: 10px; box-shadow: 0px 0px 15px rgba(0, 0, 0, 0.15);" allowfullscreen=""></iframe>
                </div>
                <div class="row">
                    <div class="col-lg-6">
                        <div class="item phone">
                            <img src="assets/images/phone-icon.png" alt="" style="max-width: 52px;">
                            <h6>010-020-0340<br><span>Phone Number</span></h6>
                        </div>
                    </div>
                    <div class="col-lg-6">
                        <div class="item email">
                            <img src="assets/images/email-icon.png" alt="" style="max-width: 52px;">
                            <h6>info@villa.co<br><span>Business Email</span></h6>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-5">
                <form id="contact-form" action="" method="post">
                    <div class="row">
                        <div class="col-lg-12">
                            <fieldset>
                                <label for="name">Full Name</label>
                                <input type="name" name="name" id="name" placeholder="Your Name..." autocomplete="on" required>
                            </fieldset>
                        </div>
                        <div class="col-lg-12">
                            <fieldset>
                                <label for="email">Email Address</label>
                                <input type="text" name="email" id="email" placeholder="Your E-mail..." required="">
                            </fieldset>
                        </div>
                        <div class="col-lg-12">
                            <fieldset>
                                <label for="subject">Subject</label>
                                <input type="subject" name="subject" id="subject" placeholder="Subject..." autocomplete="on">
                            </fieldset>
                        </div>
                        <div class="col-lg-12">
                            <fieldset>
                                <label for="message">Message</label>
                                <textarea name="message" id="message" placeholder="Your Message"></textarea>
                            </fieldset>
                        </div>
                        <div class="col-lg-12">
                            <fieldset>
                                <button type="submit" id="form-submit" class="orange-button">Send Message</button>
                            </fieldset>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">
    $(document).ready(() => {
        var connection = new signalR.HubConnectionBuilder()
            .withUrl("https://localhost:7037/SignalRHub")
            .build();

        $("#connstatus").text(connection.state);
        connection.start().then(() => {
            $("#connstatus").text(connection.state);
            setInterval(() => {
                connection.invoke("SendLatestHouseByHouseType");
            }, 1000);
        }).catch((err) => { console.log(err) });

            // Varsayılan olarak ilk ev tipini yükle
            loadLatestHouse(1, 'appartment-content');

            // Tablar arasında geçiş yapıldığında ilgili ev tipini yükle
            $(".nav-link").click(function () {
                var houseTypeId = $(this).data("house-type-id");
                var targetContainerId = $(this).data("target-container-id");
                loadLatestHouse(houseTypeId, targetContainerId);
            });

            // SignalR'dan veri alındığında güncelle
            connection.on("GetLatestHouseByHouseType", (house) => {
                var targetContainerId = $(".nav-link.active").data("target-container-id");
                var houseContainer = $(`#${targetContainerId}`);
                houseContainer.empty(); // Eski içeriği temizle

                var houseHtml = `
                        <div class="col-lg-3">
                            <div class="info-table">
                                <ul>
                                    <li>Toplam Metrekare <span>${house.size} m2</span></li>
                                    <li>Banyo Sayısı <span>${house.bathrooms}</span></li>
                                    <li>Yatak Odası Sayısı <span>${house.bedrooms}</span></li>
                                    <li>Isınma Tipi <span>${house.heatingType}</span></li>
                                    <li>Fiyatı <span>${house.price} TL</span></li>
                                </ul>
                            </div>
                        </div>
                        <div class="col-lg-6">
                                <img src="https://www.baranselgrup.com/src/projeler/34/images/ffe841696f.jpg" alt="">
                        </div>
                        <div class="col-lg-3">
                            <h4>${house.title}</h4>
                            <p>${house.description}</p>
                            <div class="icon-button">
                                <a href="/House/HouseSingle/${house.houseId}"><i class="fa fa-calendar"></i> Daha fazla bilgi</a>
                            </div>
                        </div>
                    `;

                houseContainer.append(houseHtml);
            });
        }).catch((err) => {
            console.log(err);
        });

        function loadLatestHouse(houseTypeId, targetContainerId) {
            connection.invoke("SendLatestHouseByHouseType", houseTypeId).catch((err) => {
                console.log(err);
            });
        }
    });
</script>


